<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns="http://www.w3.org/1999/xhtml"
                template="#{LayoutMB.layout}"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui">

    <ui:define name="titleOfPage">
        Fornecedores
    </ui:define>

    <ui:define name="content">
        <h:form prependId="false"
                id="form">

            <div style="margin-bottom: 10px;">
                <h1>
                    Fornecedores
                </h1>
            </div>
            
            <p:messages autoUpdate="true" closable="true"/>

            <div class="container">
                <div class="row">
                    <div class="form-group col-md-1">
                        <p:commandButton action="form?faces-redirect=true" 
                                         ajax="false" 
                                         icon="fa fa-plus"
                                         value="Novo" 
                                         class="btn btn-primary"/>
                    </div>
                    
                    <div class="form-group col-md-2">
                        <p:commandButton value="Excluir Selecionado(s)"
                                         icon="fa fa-trash" 
                                         actionListener="#{FornecedorCrudMB.delete()}"
                                         class="btn btn-danger"
                                         process="@form"
                                         update="@form">
                            <p:confirm header="Remover"
                                       message="Deseja remover esse usuário?" 
                                       icon="ui-icon-alert" />
                        </p:commandButton>
                    </div>
                    
                    <div class="form-group col-md-2">
                        <p:commandButton action="categoria/index?faces-redirect=true" 
                                     ajax="false" 
                                     icon="fa fa-plus"
                                     value="Categorias" 
                                     class="btn btn-default"/>
                    </div>
                    
                    <div class="form-group col-md-1">
                       
                    </div>
                    <div class="form-group col-md-5">
                        <p:inputText id="inptNome" 
                                     value="#{FornecedorCrudMB.filtros.nome}" 
                                     placeholder="Pesquise por nome"
                                     class="form-control"
                                     label="Nome"/>
                    </div>
                    <div class="form-group col-md-1">
                        <p:commandButton actionListener="#{FornecedorCrudMB.filtros.filtrar()}"
                                         icon="fa fa-search"
                                         value="Buscar" 
                                         update="dataTable"
                                         class="btn btn-primary"/>
                    </div>
                    
                </div>
            </div>

            <div class="row" style="margin-top: 10px;">
                <div >
                    <p:dataTable id="dataTable"
                                 var="item"  
                                 rows="25" 
                                 paginator="true"
                                 pageLinks="5" 
                                 rowsPerPageTemplate="25,50,100"
                                 currentPageReportTemplate="Exibindo: {startRecord}-{endRecord} de {totalRecords} Registros"
                                 paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                 paginatorPosition="bottom"
                                 value="#{FornecedorCrudMB.lazyDataModel}" 
                                 selection="#{FornecedorCrudMB.itensSelecionados}"
                                 widgetVar="dataTableVar"
                                 reflow="true"
                                 emptyMessage="Nenhum registro encontrado"
                                 lazy="true">


                        <p:column selectionMode="multiple" width="5%" style="text-align: center;"/>

                        <p:column id="id" 
                                  width="5%"
                                  style="text-align: center;"
                                  exportable="true"
                                  sortBy="#{item.id}"
                                  headerText="#">
                            <p:link value="#{item.id}" 
                                    outcome="form.xhtml" >
                                <f:param name="id" value="#{item.id}"/>
                            </p:link>
                        </p:column>

                        <p:column id="nome" 
                                  exportable="true"
                                  sortBy="#{item.nome}"
                                  headerText="Nome">
                            <h:outputText value="#{item.nome}" />
                        </p:column>

                        <p:column id="cnpj" 
                                  exportable="true"
                                  sortBy="#{item.cnpj}"
                                  headerText="Cnpj">
                            <h:outputText value="#{item.cnpj}" />
                        </p:column>
                        
                        <p:column id="email" 
                                  exportable="true"
                                  sortBy="#{item.email}"
                                  headerText="Email">
                            <h:outputText value="#{item.email}" />
                        </p:column>

                        <p:column id="telefone" 
                                  exportable="true"
                                  sortBy="#{item.telefone1}"
                                  headerText="Telefone">
                            <h:outputText value="#{item.telefone1}" />
                        </p:column>
                        
                        <p:column id="categoria" 
                                  exportable="true"
                                  headerText="Categoria">
                            
                            <ui:repeat value="#{item.categoriasFornecedor}"
                                       var="cat">
                                <h:outputText value="#{cat.nome}" />
                                <br/>
                            </ui:repeat>
                        </p:column>
                        
                        <p:column id="ativo" 
                                  exportable="true"
                                  sortBy="#{item.ativo}"
                                  width="6%"
                                  style="text-align: center;"
                                  headerText="Ativo">
                            <h:outputText value="#{item.ativo ? 'Sim':'Não'}" />
                        </p:column>
                    </p:dataTable>
                </div>
            </div>

            <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                <p:commandButton value="Sim" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
                <p:commandButton value="Não" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
            </p:confirmDialog>

        </h:form>
    </ui:define>

</ui:composition>
